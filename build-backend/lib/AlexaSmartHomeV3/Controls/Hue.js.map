{"version":3,"file":"Hue.js","sourceRoot":"","sources":["../../../../src/lib/AlexaSmartHomeV3/Controls/Hue.ts"],"names":[],"mappings":"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","sourcesContent":["import Capabilities from '../Alexa/Capabilities';\nimport type PowerController from '../Alexa/Capabilities/PowerController';\nimport type BrightnessController from '../Alexa/Capabilities/BrightnessController';\nimport type ColorTemperatureController from '../Alexa/Capabilities/ColorTemperatureController';\nimport { configuredRangeOrDefault, denormalize_0_100, normalize_0_100, closestFromList } from '../Helpers/Utils';\nimport Properties from '../Alexa/Properties';\nimport PowerState from '../Alexa/Properties/PowerState';\nimport Brightness from '../Alexa/Properties/Brightness';\nimport AdapterProvider from '../Helpers/AdapterProvider';\nimport AdjustableControl from './AdjustableControl';\nimport type { Base as PropertiesBase, ControlStateInitObject } from '../Alexa/Properties/Base';\nimport type { AlexaV3Category, AlexaV3DirectiveValue, AlexaV3Request } from '../types';\nimport type { Base as CapabilitiesBase } from '../Alexa/Capabilities/Base';\nimport Color from '../Alexa/Properties/Color';\nimport ColorTemperatureInKelvin from '../Alexa/Properties/ColorTemperatureInKelvin';\n\nexport default class Hue extends AdjustableControl {\n    private _powerControllerCapability!: PowerController;\n    private _powerState!: PowerState;\n    private _brightnessCapability!: BrightnessController;\n    private _brightness!: Brightness;\n    private _colorTemperatureCapability!: ColorTemperatureController;\n\n    get categories(): AlexaV3Category[] {\n        return ['LIGHT'];\n    }\n\n    adjustableProperties(): (typeof PropertiesBase)[] {\n        return [Properties.ColorTemperatureInKelvin];\n    }\n\n    initCapabilities(): CapabilitiesBase[] {\n        const map = this.statesMap;\n        const result = [new Capabilities.ColorController()];\n\n        // if the state DIMMER or BRIGHTNESS configured\n        if (this.states[map.dimmer] || this.states[map.brightness]) {\n            this._brightnessCapability = new Capabilities.BrightnessController();\n            this._brightness = this._brightnessCapability.brightness;\n            result.push(this._brightnessCapability);\n        }\n\n        // if the state TEMPERATURE configured\n        if (this.states[map.temperature]) {\n            this._colorTemperatureCapability = new Capabilities.ColorTemperatureController();\n            result.push(this._colorTemperatureCapability);\n        }\n\n        // if the state ON, DIMMER or BRIGHTNESS configured\n        if (this.states[map.on] || this._brightness) {\n            this._powerControllerCapability = new Capabilities.PowerController();\n            this._powerState = this._powerControllerCapability.powerState;\n            result.push(this._powerControllerCapability);\n        }\n\n        for (const property of result.flatMap(item => item.properties)) {\n            const initObj = this.composeInitObject(property);\n            if (initObj) {\n                property.init(initObj);\n            }\n        }\n\n        return result;\n    }\n\n    async getOrRetrieveCurrentValue(property: Color): Promise<ioBroker.StateValue> {\n        const map = this.statesMap;\n\n        if (property.currentValue === undefined) {\n            property.currentValue = await AdapterProvider.getState(property.getId);\n            // convert the non-zero brightness to power = true\n            if (property.propertyName === Properties.PowerState.propertyName && !this.states[map.on]) {\n                property.currentValue = property.currentValue !== 0;\n            }\n\n            if (property.propertyName === Properties.Color.propertyName) {\n                // @ts-expect-error special case for Color property\n                property.currentValue = {\n                    hue: property.currentValue,\n                    saturation: property.hal.saturation,\n                    brightness: property.hal.brightness,\n                };\n            }\n        }\n\n        if (property.currentValue === undefined) {\n            throw new Error(`unable to retrieve ${property.getId}`);\n        }\n\n        return property.currentValue;\n    }\n\n    async setState(property: PropertiesBase, value: ioBroker.StateValue | undefined): Promise<void> {\n        const map = this.statesMap;\n\n        if (property.propertyName === PowerState.propertyName) {\n            if (this.states[map.on]) {\n                await AdapterProvider.setState(property.setId, value ?? false);\n                property.currentValue = value;\n            } else {\n                if (value) {\n                    // set brightness\n                    // set byOn to the configured value or range.max otherwise\n                    const range = configuredRangeOrDefault(this.states[map.dimmer] || this.states[map.brightness]!);\n                    const smartName = (this.states[map.dimmer] || this.states[map.brightness])?.smartName;\n                    let byOn: string | number | undefined | null;\n                    if (smartName && typeof smartName === 'object') {\n                        byOn = smartName.byON;\n                    }\n                    byOn =\n                        byOn === null || byOn === undefined || isNaN(byOn as number)\n                            ? (range.max as number)\n                            : parseFloat(byOn as string);\n                    await AdapterProvider.setState(this._brightness.setId, byOn);\n                    this._brightness.currentValue = byOn;\n                    this._powerState.currentValue = true;\n                } else {\n                    // set brightness to 0 on power OFF\n                    await AdapterProvider.setState(this._brightness.setId, 0);\n                    this._brightness.currentValue = 0;\n                    this._powerState.currentValue = false;\n                }\n            }\n        } else if (property.propertyName === Brightness.propertyName) {\n            await AdapterProvider.setState(property.setId, value ?? 0);\n            property.currentValue = value;\n        } else if (property.propertyName === Color.propertyName) {\n            const colorProperty = property as Color;\n            const hueValue = value as unknown as { hue: number; saturation: number };\n            await AdapterProvider.setState(colorProperty.hal.hue, hueValue.hue);\n            if (colorProperty.hal.saturation) {\n                await AdapterProvider.setState(colorProperty.hal.saturation, hueValue.saturation);\n            }\n\n            // do not set brightness\n\n            // https://developer.amazon.com/en-US/docs/alexa/device-apis/alexa-colorcontroller.html\n            // Important: For the best user experience, when you make a color change, maintain the current brightness setting of the endpoint.\n            // For example, if a light bulb is currently set to white at 0.5 brightness, and a user requests a color change to red,\n            // the SetColor directive specifies hue = 0, saturation = 1, and brightness = 1. Here, set the hue to 0, the saturation to 1,\n            // and ignore the brightness value of 1 in the directive. Instead, maintain the current brightness value of 0.5.\n\n            property.currentValue = value;\n        } else if (property.propertyName === ColorTemperatureInKelvin.propertyName) {\n            await AdapterProvider.setState(property.setId, value ?? 2200);\n            property.currentValue = value;\n        }\n    }\n\n    async adjustValue(event: AlexaV3Request, property: PropertiesBase): Promise<AlexaV3DirectiveValue> {\n        // extract Alexa delta value from event\n        const delta = property.alexaDirectiveValue(event);\n\n        // convert delta to iobroker value\n        const value = property.value(delta);\n\n        // set iobroker state\n        await this.setState(property, value);\n\n        return value as AlexaV3DirectiveValue;\n    }\n\n    composeInitObject(property: PropertiesBase): ControlStateInitObject | undefined {\n        const map = this.statesMap;\n\n        if (property.propertyName === Properties.PowerState.propertyName) {\n            return {\n                setState: this.states[map.on] || this.states[map.dimmer] || this.states[map.brightness]!,\n                getState: this.states[map.on] || this.states[map.dimmer] || this.states[map.brightness]!,\n                alexaSetter: function (this: PropertiesBase, alexaValue: AlexaV3DirectiveValue): ioBroker.StateValue {\n                    return alexaValue === PowerState.ON;\n                },\n                alexaGetter: function (\n                    this: PropertiesBase,\n                    value: ioBroker.StateValue | undefined,\n                ): AlexaV3DirectiveValue {\n                    return value ? PowerState.ON : PowerState.OFF;\n                },\n            };\n        }\n\n        if (property.propertyName === Brightness.propertyName) {\n            return {\n                setState: this.states[map.dimmer] || this.states[map.brightness]!,\n                getState: this.states[map.dimmer] || this.states[map.brightness]!,\n                alexaSetter: function (this: PropertiesBase, alexaValue: AlexaV3DirectiveValue): ioBroker.StateValue {\n                    return (\n                        denormalize_0_100(\n                            alexaValue as number,\n                            this.valuesRangeMin as number,\n                            this.valuesRangeMax as number,\n                        ) ?? 0\n                    );\n                },\n                alexaGetter: function (\n                    this: PropertiesBase,\n                    value: ioBroker.StateValue | undefined,\n                ): AlexaV3DirectiveValue {\n                    return normalize_0_100(\n                        value as number,\n                        this.valuesRangeMin as number,\n                        this.valuesRangeMax as number,\n                    );\n                },\n            };\n        }\n\n        if (property.propertyName === Properties.Color.propertyName) {\n            return {\n                hal: {\n                    hue: this.states[map.hue]!.id,\n                    saturation: this.states[map.saturation]?.id,\n                    brightness: (this.states[map.dimmer] || this.states[map.brightness])?.id,\n                },\n            };\n        }\n\n        if (property.propertyName === Properties.ColorTemperatureInKelvin.propertyName) {\n            return {\n                setState: this.states[map.temperature]!,\n                getState: this.states[map.temperature]!,\n                alexaSetter: function (\n                    this: ColorTemperatureInKelvin,\n                    alexaValue: AlexaV3DirectiveValue,\n                ): ioBroker.StateValue {\n                    if (alexaValue === 1) {\n                        // increase directive\n                        const closest = closestFromList(\n                            (this.currentValue as number) || this.colorTemperatureTable[0],\n                            this.colorTemperatureTable,\n                        );\n                        let index = this.colorTemperatureTable.indexOf(closest) + 1;\n                        index =\n                            index >= this.colorTemperatureTable.length ? this.colorTemperatureTable.length - 1 : index;\n                        return this.colorTemperatureTable[index];\n                    }\n                    if (alexaValue === -1) {\n                        // decrease directive\n                        const closest = closestFromList(\n                            (this.currentValue as number) || this.colorTemperatureTable[0],\n                            this.colorTemperatureTable,\n                        );\n                        let index = this.colorTemperatureTable.indexOf(closest) - 1;\n                        index = index < 0 ? 0 : index;\n                        return this.colorTemperatureTable[index];\n                    }\n\n                    return alexaValue as number;\n                },\n                alexaGetter: function (\n                    this: PropertiesBase,\n                    value: ioBroker.StateValue | undefined,\n                ): AlexaV3DirectiveValue {\n                    return value as number;\n                },\n            };\n        }\n    }\n}\n"]}